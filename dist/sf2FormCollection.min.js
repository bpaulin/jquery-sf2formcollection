/*
 *  sf2FormCollection - v0.2.0
 *  sf2FormCollection
 *  https://github.com/bpaulin/jquery-sf2formcollection
 *
 *  Made by Bruno Paulin
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="sf2FormCollection",d={addItem:"Add an item",prependAddItem:!1,tokenIndex:"__NAME__",removeItem:!1,prependRemoveItem:!1,sortItem:!1,prependSortItem:!0};b.prototype={init:function(){var b,c,d=this,e=a('<div class="sf2fc-items"></div>');a(this.element).children("*").each(function(){item=a('<div class="sf2fc-item"></div>'),a(this).detach().appendTo(item),item.appendTo(e)}),e.appendTo(a(this.element)),a(this.element).data("index",e.contents().length);try{if(b=a("body").find(this.settings.addItem),0===b.length)throw"addItem not found"}catch(f){b=a('<div class="sf2fc-add"></div>'),c=a.parseHTML(this.settings.addItem),a.each(c,function(a,c){b.append(c)}),this.settings.prependAddItem?b.prependTo(a(this.element)):b.appendTo(a(this.element))}return b.on("click",function(b){b.preventDefault();var c=a(d.element).data("prototype"),e=a(d.element).data("index"),f=new RegExp(d.settings.tokenIndex,"g");c=c.replace(f,e),item=a('<div class="sf2fc-item"></div>'),item.append(c),d.settings.removeItem&&(containerRemoveElement=a('<div class="sf2fc-remove"></div>'),removeElement=a.parseHTML(d.settings.removeItem),a.each(removeElement,function(a,b){containerRemoveElement.append(b)}),d.settings.prependRemoveItem?containerRemoveElement.prependTo(item):containerRemoveElement.appendTo(item),containerRemoveElement.click(function(){a(this).parent().remove()})),d.settings.sortItem&&(containerSortElement=a('<div class="sf2fc-sort"></div>'),sortElement=a.parseHTML(d.settings.sortItem),a.each(sortElement,function(a,b){containerSortElement.append(b)}),d.settings.prependSortItem?containerSortElement.prependTo(item):containerSortElement.appendTo(item)),a(d.element).find(".sf2fc-items").append(item),a(d.element).data("index",e+1)}),this.settings.removeItem&&a(this.element).find(".sf2fc-items").children("*").each(function(){containerRemoveElement=a('<div class="sf2fc-remove"></div>'),removeElement=a.parseHTML(d.settings.removeItem),a.each(removeElement,function(a,b){containerRemoveElement.append(b)}),d.settings.prependRemoveItem?containerRemoveElement.prependTo(a(this)):containerRemoveElement.appendTo(a(this)),containerRemoveElement.click(function(){a(this).parent().remove()})}),this.settings.sortItem&&(a(this.element).find(".sf2fc-items").sortable({cursor:"move",handle:".sf2fc-sort"}),a(this.element).find(".sf2fc-items").children("*").each(function(){containerSortElement=a('<div class="sf2fc-sort"></div>'),sortElement=a.parseHTML(d.settings.sortItem),a.each(sortElement,function(a,b){containerSortElement.append(b)}),d.settings.prependSortItem?containerSortElement.prependTo(a(this)):containerSortElement.appendTo(a(this))})),a(this)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);