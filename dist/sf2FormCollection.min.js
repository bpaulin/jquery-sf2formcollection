/*
 *  sf2FormCollection - v0.3.0
 *  sf2FormCollection
 *  https://github.com/bpaulin/jquery-sf2formcollection
 *
 *  Made by Bruno Paulin
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="sf2FormCollection",d={addItem:"Add an item",prependAddItem:!1,tokenIndex:"__NAME__",removeItem:!1,prependRemoveItem:!1,sortItem:!1,prependSortItem:!0};b.prototype={init:function(){function b(){e.settings.removeItem&&(containerRemoveElement=a("<div>").addClass("sf2fc-remove"),removeElement=a.parseHTML(e.settings.removeItem),a.each(removeElement,function(a,b){containerRemoveElement.append(b)}),e.settings.prependRemoveItem?containerRemoveElement.prependTo(this):containerRemoveElement.appendTo(this),containerRemoveElement.click(function(){a(this).parent().remove()})),e.settings.sortItem&&(containerSortElement=a("<div>").addClass("sf2fc-sort"),sortElement=a.parseHTML(e.settings.sortItem),a.each(sortElement,function(a,b){containerSortElement.append(b)}),e.settings.prependSortItem?containerSortElement.prependTo(this):containerSortElement.appendTo(this))}var c,d,e=this,f=a("<div>").addClass("sf2fc-items");a(this.element).children("*").each(function(){var b=a("<div>").addClass("sf2fc-item");a(this).detach().appendTo(b),b.appendTo(f)}),f.appendTo(a(this.element)),a(this.element).data("index",f.contents().length),a(this.element).find(".sf2fc-items").children("*").each(b);try{if(c=a("body").find(this.settings.addItem),0===c.length)throw"addItem not found"}catch(g){c=a("<div>").addClass("sf2fc-add"),d=a.parseHTML(this.settings.addItem),a.each(d,function(a,b){c.append(b)}),this.settings.prependAddItem?c.prependTo(a(this.element)):c.appendTo(a(this.element))}return c.on("click",function(c){c.preventDefault();var d=a(e.element).data("prototype"),f=a(e.element).data("index"),g=new RegExp(e.settings.tokenIndex,"g");d=d.replace(g,f),item=a("<div>").addClass("sf2fc-item"),item.append(d),item.each(b),a(e.element).find(".sf2fc-items").append(item),a(e.element).data("index",f+1)}),this.settings.sortItem&&a(this.element).find(".sf2fc-items").sortable({cursor:"move",handle:".sf2fc-sort"}),a(this)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);