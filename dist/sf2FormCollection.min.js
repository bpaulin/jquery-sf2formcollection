/*
 *  sf2FormCollection - v0.3.0
 *  sf2FormCollection
 *  https://github.com/bpaulin/jquery-sf2formcollection
 *
 *  Made by Bruno Paulin
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="sf2FormCollection",d={addItem:"Add an item",prependAddItem:!1,tokenIndex:"__NAME__",removeItem:!1,prependRemoveItem:!1,sortItem:!1,prependSortItem:!0,selectorIndex:!1};b.prototype={init:function(){function b(){f.settings.removeItem&&(containerRemoveElement=a("<div>").addClass("sf2fc-remove"),removeElement=a.parseHTML(f.settings.removeItem),a.each(removeElement,function(a,b){containerRemoveElement.append(b)}),f.settings.prependRemoveItem?containerRemoveElement.prependTo(this):containerRemoveElement.appendTo(this),containerRemoveElement.click(function(){a(this).parent().remove(),c()})),f.settings.sortItem&&(containerSortElement=a("<div>").addClass("sf2fc-sort"),sortElement=a.parseHTML(f.settings.sortItem),a.each(sortElement,function(a,b){containerSortElement.append(b)}),f.settings.prependSortItem?containerSortElement.prependTo(this):containerSortElement.appendTo(this))}function c(){a(f.element).find(".sf2fc-items").find(".sf2fc-item").each(function(b){a(this).find(f.settings.selectorIndex).html(b)})}var d,e,f=this,g=a("<div>").addClass("sf2fc-items");a(this.element).children("*").each(function(){var b=a("<div>").addClass("sf2fc-item");a(this).detach().appendTo(b),b.appendTo(g)}),g.appendTo(a(this.element)),a(this.element).data("index",g.contents().length),a(this.element).find(".sf2fc-items").children("*").each(b);try{if(d=a("body").find(this.settings.addItem),0===d.length)throw"addItem not found"}catch(h){d=a("<div>").addClass("sf2fc-add"),e=a.parseHTML(this.settings.addItem),a.each(e,function(a,b){d.append(b)}),this.settings.prependAddItem?d.prependTo(a(this.element)):d.appendTo(a(this.element))}return d.on("click",function(d){d.preventDefault();var e=a(f.element).data("prototype"),g=a(f.element).data("index"),h=new RegExp(f.settings.tokenIndex,"g");e=e.replace(h,g),item=a("<div>").addClass("sf2fc-item"),item.append(e),item.each(b),a(f.element).find(".sf2fc-items").append(item),a(f.element).data("index",g+1),c()}),this.settings.sortItem&&(a(this.element).find(".sf2fc-items").sortable({cursor:"move",handle:".sf2fc-sort",update:function(){c()}}),c(),a(this.element).find(".sf2fc-items").bind({update:function(){c()}})),a(this)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);